# Functional Flow Diagram for `cpdEvaluateUStarTh4Season20100901` Function

## Start
|
|-- **Initialize Function**
|   - Define function with inputs: `t`, `NEE`, `uStar`, `T`, `fNight`, `fPlot`, `cSiteYr`
|
|-- **Initializations**
|   - Calculate `nt` (length of `t`)
|   - Extract year, month, day vectors from `t` using `fcDatevec`
|   - Calculate `iYr` (median year) and `EndDOY` (end day of year)
|   - Determine `nPerDay` (number of periods per day based on median difference in `t`)
|
|-- **Set Parameters**
|   - Set parameters: `nSeasons = 4`, `nStrataN = 4`, `nStrataX = 8`, `nBins = 50`, `nPerBin = 5`
|   - Adjust `nPerBin` based on `nPerDay` (24 or 48)
|   - Calculate `nPerSeasonN` and `nN`
|
|-- **Filter Invalid Data**
|   - Find and filter out invalid `uStar` values (`uStar < 0` or `uStar > 3`)
|   - Identify valid indices for annual nighttime data (`itAnnual`) and calculate `ntAnnual`
|
|-- **Initialize Outputs**
|   - Initialize `Cp2`, `Cp3`, `Stats2`, `Stats3` arrays with NaN values
|   - Initialize `StatsMT` structure with default NaN values
|
|-- **Check Sufficient Data**
|   - If `ntAnnual` (valid annual nighttime data points) is less than `nN`, return
|
|-- **Reorder Data**
|   - Move December data to the beginning of the year and reorder
|   - Update `t`, `T`, `uStar`, `NEE`, `fNight` accordingly
|   - Recalculate `itAnnual` and `ntAnnual`
|
|-- **Reset Parameters**
|   - Calculate `nSeasons` based on actual number of good data
|   - Recalculate `nPerSeason`
|
|-- **Stratify Data**
|   - Stratify data by time using moving windows and by temperature class
|   - For each season and temperature class, estimate change points `Cp2` and `Cp3`
|
|-- **Plotting (if enabled)**
|   - Initialize plot settings if `fPlot` is set to 1
|   - Plot results for each season and strata if `fPlot` is set to 1
|
|-- **Season Loop**
|   - For each season `iSeason`
|   |   - Determine indices for the season (`jtSeason`, `itSeason`)
|   |   - Calculate number of strata based on `ntSeason`
|   |   - Calculate temperature thresholds `TTh`
|   |   - For each strata `iStrata`
|   |   |   - Find indices for the strata (`itStrata`)
|   |   |   - Bin `uStar` and `NEE` data and calculate mean values
|   |   |   - Call `cpdFindChangePoint20100901` to find change points
|   |   |   - Add additional fields to `xs2` and `xs3` not assigned by change-point function
|   |   |   - Store results in `Cp2`, `Cp3`, `Stats2`, `Stats3`
|
|-- **End**
